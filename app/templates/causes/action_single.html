{% extends "base_form.html" %}
{% set active_page = "action" %}

{% block title %}
    {{ action.title }}
    - {{ super() }}
{% endblock %}

{% block content %}
{% from "helpers/users.html" import render_avatar %}
<div class="container u-add-margin-top">
    <div class="row">
        <div class="twelve columns">
            <a class="action-support-cause-title" href="{{ url_for('causes.cause_detail', slug=cause.slug) }}">
                <h1>{{ cause.title }}</h1>
            </a>
            <hr>
        </div>
    </div>
    <div class="row">
        <div class="two-thirds column">
            <h3 class="u-pull-left">
                <span class="oi" 
                      data-glyph="check" 
                      style="display:{% if current_user in action.supporters.all() %}inline{% else %}none{% endif %};"></span>  
                {{ action.title }}
            </h3>
        </div>
        <div class="one-third column">
            {% if current_user not in action.supporters.all() %}
            <p class="u-remove-margin-bottom u-pull-right">
                {% if current_user.is_authenticated %}
                    {% if action.link %}
                    <a id="action-{{ action.id }}" class="button button-primary support" rel="external" target="_blank"
                       href="{{ action.link }}">{{ _('Support!') }}</a>
                    {% else %}
                    <a id="action-{{ action.id }}" 
                       class="button button-primary support" 
                       href="{{ url_for('causes.action_support', slug=cause.slug, pk=action.id) }}">
                        {{ _('Support!') }}
                    </a>
                    {% endif %}
                {% else %} 
                <a class="button button-primary support"
                   href="{{ url_for('users.login', next='/cause/' + cause.slug + '/dashboard') }}#modal-action-{{ action.id }}">{{ _('Support!') }}</a>
                {% endif %}
            </p>
            {% else %}
            <p class="u-remove-margin-bottom u-pull-right">
                {% if action.link %}
                    <a id="action-{{ action.id }}" class="button button-primary support" rel="external" target="_blank"
                       href="{{ action.link }}">{{ _('Go to 3rd party site') }}</a>
                {% endif %}
            </p>
            {% endif %}
            {% if current_user in cause.creators.all() or current_user.is_admin %}
            <p class="u-remove-margin-bottom u-pull-right">
                <a class="button primary u-add-margin-right" 
                    href="{{ url_for('causes.action_add_edit', slug=cause.slug,
                    pk=action.id) }}">{{ _('Edit') }}</a>
            </p>
            {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="two-thirds column">
            <p>{{ action.description|markdown }}</p>
            {% if action.expiration %}
            <small class="support-action-expiration">
                Expires: {{ action.expiration.strftime('%b. %d, %Y') }}
            </small>
            {% endif %}
        </div>
        <div class="one-third column">
            <p class="support-action-counter u-pull-right"> 
                <strong>{{ _('%(count)s people took this action', count=action.supporters.count()) }}</strong>
            </p>
            <br class="u-cf">
            <span class="support-action-takers">
                {% for supporter in action.supporters %}
                    {{ render_avatar(supporter) }}
                {% endfor %}
            </span>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
        </div>
    </div>
</div>
{% endblock %}

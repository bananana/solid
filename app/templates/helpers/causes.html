<!-- If you add another macro to this file or significatly edit an existing one, 
dont' forget to add a description of your changes to the appropriate styleguide
section (app/templates/styleguide/templating#cause-helpers)
-->

{% macro render_cause_info(caption, info) %}
<p class="u-cf u-remove-margin-bottom">
    <strong>{{ caption }}</strong>
</p>
<h2>{{ info }}</h2>
{% endmacro %}

{% macro render_log(log) %}
{% from "helpers/users.html" import render_avatar %}
{% from "helpers/posts.html" import render_post with context %}
{% set captions={
    1: 'added a cause',
    2: 'edited a cause',
    3: 'supported a cause',
    4: 'reached cause milestone',
    5: 'added an action',
    6: 'supported an action',
    7: 'commented on action',
    8: 'said',
    9: 'posted a reply',
    }
%}
{% set log_loop = namespace(previous=None) %}
{% for event in log %}
    {% if log_loop.previous != event.logged_at.strftime('%b. %d, %Y') %} 
        <small class="feed-separator">
            <span>
                {{ event.logged_at.strftime('%b. %d, %Y') }}
            </span>
        </small>
    {% endif %}
    {% set log_loop.previous = event.logged_at.strftime('%b. %d, %Y') %} 
    <div class="feed-item">
        {% if event.event_type_id in [1,2,3,4] %}
        <p>
            {{ render_avatar(event.user) }}&nbsp;
            {{ captions[event.event_type_id] }}:
            <a class="feed-link"  href="{{ url_for('causes.cause_detail', slug=event.item.slug) }}">
                {{ event.item.title }}
            </a>
        </p>
        {% elif event.event_type_id in [5,6,7] %}
        <p>
            {{ render_avatar(event.user) }}&nbsp;
            {{ captions[event.event_type_id] }}:
            <a class="feed-link"  data-target="modal-action-{{ event.item.id }}">
                {{ event.item.title }}
            </a>
        </p>
        {% elif event.event_type_id in [8] %}
            {{ render_post(event.item.cause, event.item) }}
        {% endif %}
    </div>
{% endfor %}
{% endmacro %}

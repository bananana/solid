<!-- If you add another macro to this file or significatly edit an existing one, 
dont' forget to add a description of your changes to the appropriate styleguide
section (app/templates/styleguide/templating#discussion-helpers)
-->

{% from "helpers/users.html" import render_avatar %}

{% macro render_post(cause, post) %}
<div class="post">
    <article id="post-body-{{ post.id }}">
        {{ post.body | markdown | striptags | truncate(90, True) }} 
        {% for image in post.images.all() %}
            <image src="{{ image.image_path|resize('50x50', fill=True) }}" />
        {% endfor %}
    </article>
    <p class="u-add-margin-top u-remove-margin-bottom">
        <small>
            {{ render_avatar(post.author) }}&nbsp;
            <a href="{{ url_for('posts.post_detail', slug=cause.slug, pk=post.id) }}">
                {{ post.created_on.strftime('%b. %d, %Y') }}
            </a>
            {% if post.author == current_user or current_user.is_admin %}
            <a href="{{ url_for('posts.post_edit', slug=cause.slug, pk=post.id) }}">
                {{ _('(edit)') }}
            </a>
            <img class="icon u-add-margin-left" 
                src="{{ url_for('static', filename='open-iconic/png/comment-square-2x.png') }}"> 
            {{ _('%(count)s comments', count=post.comments.count()) }}
            {% endif %}
        </small>
    </p>
</div>
{% endmacro %}

{% macro render_post_list(cause) %}
{% if cause.posts %}
    {% for post in cause.posts.all() %}
        {% if loop.first  %}<div class="row">{% endif %}
        {{ render_post(cause, post) }}
        {% if loop.index is divisibleby(3) and not loop.last %}</div><div class="row">{% endif %}
        {% if loop.last %}</div>{% endif %}
    {% endfor %}
{% else %}
    <div class="four columns offset-by-four">
        <p>
            <strong>
                {{ _('No posts!') }}
            </strong>
            <a class="button u-add-margin-left"
                href="{{ url_for('posts.post_add', slug=cause.slug) }}">
                {{ _('Start the conversation') }}
            </a>
        </p>
    </div>
{% endif %}
{% endmacro %}

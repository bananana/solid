<!-- If you add another macro to this file or significatly edit an existing one, 
dont' forget to add a description of your changes to the appropriate styleguide
section (app/templates/styleguide/templating#log-helpers)
-->

{% macro render_log(log) %}
{% set captions={
    1: 'added a cause',
    2: 'edited a cause',
    3: 'supported a cause',
    4: 'reached cause milestone',
    5: 'added an action',
    6: 'supported an action',
    7: 'commented on action',
    8: 'said',
    9: 'posted a reply',
    }
%}
{% from "helpers/users.html" import render_avatar %}
{% from "helpers/posts.html" import render_post with context %}
{% from "helpers/posts.html" import render_post_comment with context %}
{% set log_loop = namespace(previous=None) %}
{% for event in log %}
    {% if log_loop.previous != event.logged_at.strftime('%b. %d, %Y') and not event.item.deleted %} 
        <small class="separator">
            <span>
                {{ event.logged_at.strftime('%b. %d, %Y') }}
            </span>
        </small>
    {% endif %}
    {% set log_loop.previous = event.logged_at.strftime('%b. %d, %Y') %} 
    <div class="feed-item">
        {% if event.event_type_id in [1,2,3,4] %}
        <p>
            {{ render_avatar(event.user) }}&nbsp;
            {{ captions[event.event_type_id] }}:
            <a class="feed-link"
               href="{{ url_for('causes.cause_detail', slug=event.item.slug) }}">
                {{ event.item.title }}
            </a>
        </p>
        {% elif event.event_type_id in [5,6,7] %}
        <p>
            {{ render_avatar(event.user) }}&nbsp;
            {{ captions[event.event_type_id] }}:
            <a class="feed-link"  
               href="{{ url_for('causes.action_detail', slug=event.item.cause.slug, pk=event.item.id) }}">
                {{ event.item.title }}
            </a>
        </p>
        {% elif event.event_type_id == 8 and event.item and not event.item.deleted %}
            {{ render_post(event.item.cause, event.item) }}
        {% elif event.event_type_id == 9 and event.item and not event.item.deleted %}
            {{ render_post_comment(event.item.post.cause, event.item) }}
        {% endif %}
    </div>
{% endfor %}
{% endmacro %}

{% macro render_log_notifications(log) %}
{% set captions={
    1: 'added a cause',
    2: 'edited a cause',
    3: 'supported a cause',
    4: 'reached cause milestone',
    5: 'added an action',
    6: 'supported action',
    7: 'commented on action',
    8: '',
    9: 'posted a reply to'
    }
%}
{% from "helpers/users.html" import render_avatar %}
{% from "helpers/posts.html" import render_post with context %}
{% from "helpers/posts.html" import render_post_comment with context %}
{% for event, viewed in log %}
    <div class="notification{% if not viewed %} new{% endif %}">
    <p>
        {% if not viewed %}<img class="u-pull-left" src="{{ url_for('static', filename='open-iconic/png/flash-2x.png') }}">&nbsp;{% endif %}
        {% if event.event_type_id in [1,2,3,4] %}
            {{ render_avatar(event.user) }}&nbsp;
            {{ captions[event.event_type_id] }}:
            <a class="feed-link"
               href="{{ url_for('causes.cause_detail', slug=event.item.slug) }}">
                {{ event.item.title }}
            </a>
        {% elif event.event_type_id in [5,6,7] %}
            {{ render_avatar(event.user) }}&nbsp;
            {{ captions[event.event_type_id] }}:
            <a class="feed-link"  
               href="{{ url_for('causes.action_detail', slug=event.item.cause.slug, pk=event.item.id) }}">
                {{ event.item.title }}
            </a>
        {% elif event.event_type_id == 8 %}
            {{ render_avatar(event.user) }}&nbsp;
            {# captions[event.event_type_id] #}
            made a new 
            <a class="feed-link"  
               href="{{ url_for('posts.post_detail', slug=event.item.cause.slug, pk=event.item.id) }}">
                post
            </a>
            on
            "<a href="{{ url_for('causes.cause_detail', slug=event.item.cause.slug) }}">{{ event.item.cause.title }}</a>"
        {% elif event.event_type_id == 9 %}
            {{ render_avatar(event.user) }}&nbsp;
            {{ captions[event.event_type_id] }}
            {{ render_avatar(event.item.post.author) }}'s
            <a class="feed-link"  
               href="{{ url_for('posts.post_detail', slug=event.item.post.cause.slug, pk=event.item.post.id) }}">
                post
            </a>
        {% endif %}
    </p>
</div>
{% endfor %}
{% endmacro %}
